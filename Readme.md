# OCR для распознавания медицинских анализов на русском языке

## Описание проекта

Данное программное решение представляет собой Telegram бота для автоматического распознавания таблиц из медицинских анализов на русском языке с использованием технологии OCR (оптического распознавания символов). Система специально адаптирована для работы с кириллическими символами и особенностями форматирования медицинской документации.

## Возможности

- Распознавание текста и структуры таблиц с медицинскими анализами
- Поддержка кириллицы (русского языка)
- Работа через удобный интерфейс Telegram бота
- Два метода распознавания на выбор:
  - PaddleOCR - высокоточная модель с поддержкой русского языка
  - Mixed Approach - комбинированный подход с использованием MS EasyOCR
- Экспорт результатов в Excel формат
- Визуализация обнаруженных таблиц и текста

## Требования к системе

- Ubuntu (рекомендуется Ubuntu 20.04 или новее)
- Python 3.8+
- CUDA-совместимая видеокарта (опционально, для ускорения на GPU)
- Минимум 8 ГБ RAM
- Минимум 10 ГБ свободного места на диске

## Установка

### 1. Клонирование репозитория

```bash
git clone https://github.com/ваш-репозиторий/OCR.git
cd OCR
```

### 2. Настройка виртуальных окружений

Для PaddleOCR:

```bash
python3 -m venv ocr_venv_py38
source ocr_venv_py38/bin/activate
pip install -r requirements_paddle.txt
pip install paddlepaddle-gpu  # или paddlepaddle для CPU версии
pip install python-telegram-bot
deactivate
```

Для Mixed Approach:

```bash
python3 -m venv ms_easy_ocr
source ms_easy_ocr/bin/activate
pip install -r requirements_mixed.txt
pip install python-telegram-bot
deactivate
```

### 3. Загрузка предобученных моделей

```bash
mkdir -p model
cd model

# Скачивание моделей PaddleOCR
wget https://paddleocr.bj.bcebos.com/PP-OCRv3/multilingual/Multilingual_PP-OCRv3_det_infer.tar
tar -xf Multilingual_PP-OCRv3_det_infer.tar

# Скачивание модели для распознавания структуры таблиц
mkdir -p ../inference
cd ../inference
wget https://paddleocr.bj.bcebos.com/ppstructure/models/slanet/en_ppstructure_mobile_v2.0_SLANet_infer.tar
tar -xf en_ppstructure_mobile_v2.0_SLANet_infer.tar

# Загрузка модели для распознавания кириллицы
# Ссылка на модель trained_cyrillic_PP-OCRv3_rec
# (Необходимо скачать вручную и разместить в папке inference)
```

### 4. Настройка переменных окружения

Отредактируйте скрипт `.env` или создайте его:

```bash
echo "TELEGRAM_TOKEN=ваш_токен_бота" > .env
```

## Структура проекта

```
OCR/
├── data/
│   └── uploads/      # Временное хранилище загруженных фото
├── model/            # Предобученные модели для обнаружения текста
├── inference/        # Модели для распознавания
├── output/
│   └── table/        # Результаты обработки
├── scripts/
│   ├── paddle/       # Скрипты для PaddleOCR
│   │   └── table_ocr.py
│   └── mixed/        # Скрипты для Mixed Approach
│       ├── ms_table_det.py
│       ├── ms_table_rec.py
│       └── ms_table_text_rec.py
├── PaddleOCR/        # Библиотека PaddleOCR
├── telegram_bot.py   # Основной скрипт Telegram бота
└── README.md
```

## Запуск

```bash
# Запуск бота
python telegram_bot.py
```

После запуска перейдите в Telegram и найдите бота по имени или перейдите по ссылке `t.me/имя_вашего_бота`.

## Использование

1. Отправьте команду `/start` для начала работы с ботом
2. Выберите метод обработки: PaddleOCR или Mixed Approach
3. Отправьте фотографию с таблицей медицинских анализов
4. Дождитесь обработки и получите Excel файл с распознанной таблицей
5. Команда `/clean` - очистка временного хранилища загруженных фото

## Особенности методов распознавания

### PaddleOCR
- Высокая точность распознавания символов
- Хорошая поддержка кириллицы
- Более требователен к вычислительным ресурсам
- Рекомендуется для сложных таблиц и мелкого текста

### Mixed Approach (MS EasyOCR)
- Комбинирует несколько алгоритмов для лучшего результата
- Быстрее работает на CPU
- Лучше справляется с таблицами нестандартного формата
- Может быть менее точным для некоторых шрифтов

## Советы по использованию

- Для лучшего результата делайте фото при хорошем освещении
- Избегайте бликов и теней на документе
- Убедитесь, что таблица полностью попадает в кадр
- Для сложных таблиц предпочтительнее использовать метод PaddleOCR
- Для простых таблиц Mixed Approach обычно работает быстрее

## Решение проблем

### Проблема: Бот не отвечает
- Проверьте, запущен ли скрипт `telegram_bot.py`
- Убедитесь в правильности токена Telegram

### Проблема: Ошибки при обработке изображения
- Проверьте наличие всех необходимых моделей
- Убедитесь, что фото достаточно четкое
- Попробуйте другой метод распознавания

### Проблема: Низкое качество распознавания
- Улучшите качество исходного изображения
- Попробуйте переснять документ при лучшем освещении
- Используйте PaddleOCR для сложных случаев

## Разработка и вклад в проект

Если вы хотите внести вклад в проект:
1. Создайте форк репозитория
2. Внесите изменения
3. Отправьте pull request

## Лицензия

[MIT License](LICENSE)

